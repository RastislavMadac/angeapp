<app-navbar
  [selectedItem]="selectedProduct"
  (deleteItem)="onDeleteProduct($event)"
  (create)="createNewProduct()"
  (edit)="selectProduct($event)">
</app-navbar>

<ng-template #detailTpl>
  <form *ngIf="productForm" [formGroup]="productForm" (ngSubmit)="saveProduct()" class="modern-form">
    
    <div class="card header-card">
      <div class="header-row">
        <div class="id-badge">
          <label>ID Produktu</label>
          <input formControlName="product_id" readonly>
        </div>

        <div class="toggles-container" style="display: flex; gap: 15px;">
          
          <div class="toggle-wrapper">
            <label class="switch">
              <input type="checkbox" formControlName="is_serialized">
              <span class="slider round"></span>
            </label>
            <span class="toggle-label">Sériový</span>
          </div>

          <div class="toggle-wrapper">
            <label class="switch">
              <input type="checkbox" formControlName="internet">
              <span class="slider round"></span>
            </label>
            <span class="toggle-label">Internet</span>
          </div>

          <div class="toggle-wrapper">
            <label class="switch">
              <input type="checkbox" formControlName="is_serialized"> 
              <span class="slider round"></span>
            </label>
            <span class="toggle-label">Aktívny</span>
          </div>
        </div>
      </div>

      <div class="main-input">
        <label>Názov produktu</label>
        <input formControlName="product_name" placeholder="Zadajte názov produktu...">
      </div>
    </div>

    <div class="cards-grid">

      <div class="card full-width">
        <h3><i class="icon-info"></i> Základné informácie</h3>
        
        <div class="input-group">
          <label>Popis</label>
          <textarea formControlName="description" rows="3"></textarea>
        </div>

        <div class="row-3">
          <div class="input-group">
            <label>Kategória</label>
            <select formControlName="category">
              <option *ngFor="let c of categories" [ngValue]="c">{{ c.name }}</option>
            </select>
          </div>

          <div class="input-group">
            <label>Typ produktu</label>
            <select formControlName="product_type">
              <option *ngFor="let pt of productType" [ngValue]="pt">{{ pt.name }}</option>
            </select>
          </div>

          <div class="input-group">
            <label>Jednotka</label>
            <select formControlName="unit">
              <option *ngFor="let u of unit" [ngValue]="u">{{ u.name }}</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <h3><i class="icon-barcode"></i> Identifikátory</h3>
        <div class="input-group">
          <label>Internet ID</label>
          <input formControlName="internet_id">
        </div>
        <div class="row-2">
          <div class="input-group">
            <label>EAN kód</label>
            <input formControlName="ean_code">
          </div>
          <div class="input-group">
            <label>QR kód</label>
            <input formControlName="qr_code">
          </div>
        </div>
        <div class="input-group">
          <label>Hmotnosť (kg)</label>
          <input type="number" formControlName="weight_item">
        </div>
      </div>

      <div class="card">
        <h3><i class="icon-wallet"></i> Cena a Sklad</h3>
        
        <div class="row-2">
          <div class="input-group">
            <label>Cena bez DPH</label>
            <input type="number" formControlName="price_no_vat">
          </div>
          <div class="input-group">
            <label>DPH (%)</label>
            <input type="number" formControlName="tax_rate">
          </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

        <div class="row-2">
          <div class="input-group">
            <label>Celkové množstvo</label>
            <input type="number" formControlName="total_quantity">
          </div>
          <div class="input-group">
            <label>Voľné</label>
            <input type="number" formControlName="free_quantity">
          </div>
        </div>
        
        <div class="row-2">
          <div class="input-group">
            <label>Rezervované</label>
            <input type="number" formControlName="reserved_quantity">
          </div>
          <div class="input-group">
            <label>Minimálne na sklade</label>
            <input type="number" formControlName="minimum_on_stock">
          </div>
        </div>
      </div>

    </div>

    <div class="form-footer">
      <button type="submit" [disabled]="productForm.invalid" class="btn-primary">
        {{ selectedProduct ? 'Uložiť produkt' : 'Vytvoriť produkt' }}
      </button>
    </div>

  </form>
</ng-template>

<app-master-layout
  [masterTemplateInput]="masterTpl"
  [detailTemplateInput]="detailTpl"
  [items]="product"
  [(selectedItem)]="selectedProduct"
  (select)="selectProduct($event)">
</app-master-layout>

<ng-template #masterTpl>
  <app-generic-table
    [columns]="columns"
    [data]="(filteredData$ | async) ?? []" 
    [selectedItem]="selectedProduct"
    (rowClick)="selectProduct($event)">
  </app-generic-table>
</ng-template>