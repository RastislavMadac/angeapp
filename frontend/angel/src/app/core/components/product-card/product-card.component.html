<router-outlet></router-outlet>


<app-navbar [selectedItem]="selectedItem"></app-navbar>

<app-small-navbar></app-small-navbar>



<ng-template #detailTpl>
    <form [formGroup]="itemForm" *ngIf="itemForm" class="product-grid">
        
        <div class="card-status-header" *ngIf="!selectedItem?.id">
            <h2 style="color: #2e7d32; margin: 0; padding: 10px 0;">
                <mat-icon style="vertical-align: middle;">add_circle</mat-icon> 
                Nov√° V√Ωrobn√° Karta (Z Pl√°nu)
            </h2>
        </div>

        <div class="product-item" [ngClass]="getStatusClass()">

            <div class="plan-header">
                <label>Produkt:
                    <input formControlName="product_name" readonly class="bold-text">
                </label>

                <label>ƒå√≠slo karty:
                    <input formControlName="card_number" class="bold-text" placeholder="Vygeneruje sa automaticky alebo zadajte...">
                </label>

                <input [formControl]="productionPlanNumberControl" readonly>
            </div>

            <hr />

            <div class="products-section">
                <div class="product-item production-summary">
                    <h3>V√Ωrobn√© √∫daje</h3>

                    <div class="product-fields">
                        <label>Pl√°novan√© mno≈æstvo:
                            <input type="number" formControlName="planned_quantity">
                        </label>
                        
                        <label>Vyroben√© (OK):
                            <input type="number" formControlName="produced_quantity" class="highlight-input" readonly>
                        </label>
                        
                        <label>Chybn√© (NOK):
                            <input type="number" formControlName="defective_quantity" class="error-input">
                        </label>
                        
                        <label>Status:
                            <select formControlName="status">
                                <option value="pending">ƒåak√°</option>
                                <option value="in_production">V procese</option>
                                <option value="partially_completed">ƒåiastoƒçne dokonƒçen√©</option>
                                <option value="completed">Dokonƒçen√©</option>
                                <option value="canceled">Zru≈°en√©</option>
                            </select>
                        </label>
                    </div>

                    <div class="notes-field" style="margin-top: 15px; padding: 0 10px;">
                        <label>Pozn√°mka k v√Ωrobe:</label>
                        <textarea formControlName="notes" rows="2" style="width: 100%; margin-top: 5px;"></textarea>
                    </div>
                </div>
            </div>

            <div class="form-actions" style="margin-top: 20px;">
                <button type="button" class="btn-save" matTooltip="Ulo≈æi≈• kartu" 
                        [disabled]="itemForm.invalid" (click)="saveItem()">
                    üíæ Ulo≈æi≈• {{ !selectedItem?.id ? 'Nov√∫ Kartu' : 'Zmeny' }}
                </button>

                <button type="button" class="btn-cancel" (click)="cancelEdit()" matTooltip="Zru≈°i≈•">
                    ‚ùå Zru≈°i≈•
                </button>

                <button type="button" class="btn-add" 
                        [routerLink]="['/production-card-plans']"
                        routerLinkActive="active" matTooltip="Vybra≈• z pl√°nu">
                    ‚ûï Prida≈• polo≈æku
                </button>

                <button type="button" class="btn-delete" (click)="deleteSelectedItem()" 
                        [disabled]="!selectedItem?.id" matTooltip="Vymaza≈• cel√∫ kartu">
                    üóëÔ∏è Vymaza≈• kartu
                </button>
            </div>

        </div>
    </form>
</ng-template>

<div class="spinner-wrapper" *ngIf="isLoading">
    <mat-progress-spinner mode="indeterminate" color="primary" diameter="50"></mat-progress-spinner>
    <p>Naƒç√≠tavam d√°ta...</p>
</div>

<div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

<app-master-layout [masterTemplateInput]="masterTpl" [detailTemplateInput]="detailTpl" [items]="objectItems"
    [(selectedItem)]="selectedItem" (select)="selectItems($event)">
</app-master-layout>

<ng-template #masterTpl>
    <ng-container *ngIf="objectItems.length">
        <app-generic-table [columns]="columns"  [data]="(filteredData$ | async) ?? []"  [selectedItem]="selectedItem"
            [defaultSortColumn]="'card_number'" (rowClick)="selectItems($event)" [rowClassMap]="rowClasses">
        </app-generic-table>
    </ng-container>

</ng-template>